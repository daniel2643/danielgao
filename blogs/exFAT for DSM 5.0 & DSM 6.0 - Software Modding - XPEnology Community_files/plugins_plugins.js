;(function($,_,undefined){"use strict";ips.createModule('ips.ui.spoiler',function(){ips.templates.set('core.editor.espoiler',"<div class='ipsSpoiler' data-ipsSpoiler><div class='ipsSpoiler_header'><span>{{#lang}}editorSpoiler{{/lang}}</span></div><div class='ipsSpoiler_contents'></div></div>");ips.templates.set('core.editor.espoilerHeader',"    <div class='ipsSpoiler_header ipsSpoiler_closed'>    <a href='#' data-action='toggleSpoiler'>&nbsp;</a>    <span>{{{full_annotation}}}</span>   </div>  ");var _prependAnnotation=function(annotation,text){if(!annotation)return text;return annotation+' ('+text+')';};var respond=function(elem,options,e){if(elem.parents('.cke_wysiwyg_div').length){return;}
elem.contents().hide();var existingHeader=elem.children('.ipsSpoiler_header');var header=ips.templates.render('core.editor.espoilerHeader',{full_annotation:_prependAnnotation(elem[0].getAttribute('data-ipsspoiler-option'),ips.getString('spoilerClickToReveal')),});if(existingHeader.length){existingHeader.replaceWith(header);}else{elem.prepend(header);}
elem.find('> .ipsSpoiler_header').on('click',_toggleSpoiler);},_toggleSpoiler=function(e){var header=$(e.currentTarget);var target=$(e.target);var spoiler=$(e.target).closest('[data-ipsSpoiler]');if(target.is('a:not( [data-action="toggleSpoiler"] )')||(target.closest('a').length&&!target.closest('a').is('[data-action="toggleSpoiler"]'))){return;}
e.preventDefault();var annotation=header.parents()[0].getAttribute('data-ipsspoiler-option');if(header.hasClass('ipsSpoiler_closed')){ips.utils.anim.go('fadeIn',header.siblings());header.removeClass('ipsSpoiler_closed').addClass('ipsSpoiler_open').find('span').text(_prependAnnotation(annotation,ips.getString('spoilerClickToHide')));$(document).trigger('contentChange',[spoiler]);var iframes=spoiler.find('iframe[data-embedcontent]');if(iframes.length){$.each(iframes,function(){this.src=this.src;});}}else{header.siblings().hide();header.removeClass('ipsSpoiler_open').addClass('ipsSpoiler_closed').find('span').text(_prependAnnotation(annotation,ips.getString('spoilerClickToReveal')));}
e.stopPropagation();};ips.ui.registerWidget('spoiler',ips.ui.spoiler);return{respond:respond}});}(jQuery,_));;